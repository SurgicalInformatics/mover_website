{
  "hash": "c124ddf92f8b6945b062cba61c1c4aea",
  "result": {
    "markdown": "---\ntitle: \"Logistic regression baseline model of respiratory complications\"\nformat: html\neditor: visual\nexecute:\n  freeze: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(finalfit)\nlibrary(purrr)\nlibrary(glmnet)\nlibrary(recipes)\nlibrary(yardstick)\nlibrary(patchwork)\nlibrary(magrittr)\ntheme_set(theme_bw())\n\n#source(\"01_read_clean.R\")\n#source(\"../repos/mover_website/functions.R\")\nsource(\"functions.R\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n# Introduction\n\nWe use the prepared and imputed data from Baseline model preparation and develop a logistic regression model of respiratory complications based on basic patient information. As a comparison we also develop a model including information from the patient LDA data set which details lines, drains, and airway devices used on the patient.\n\nNote that inpatients and outpatients are included and their status included as an explanatory variable. We also take no account of the surgical procedure at this stage.\n\nWe will perform the following analysis steps:\n\n-   Import imputed data\n\n-   Define sets of explanatory variables\n\n-   Fit Lasso regularized models and examine the cross validated regularization paths.\n\n-   Examine the variables that are used at the optimal regularization strength\n\n-   Evaluate performance with ROC and PR curves.\n\n## Import imputed data\n\nThese imputed date were generated in the Baseline model preparation script.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsets_train = read_rds(\"/home/common/mover_data/results/baseline_imputation/mice_train.rds\")\nsets_test = read_rds(\"/home/common/mover_data/results/baseline_imputation/mice_test.rds\")\n\ndata_train = read_rds(\"/home/common/mover_data/results/baseline_imputation/train_set.rds\")\ndata_test = read_rds(\"/home/common/mover_data/results/baseline_imputation/test_set.rds\")\n\n\ndata_train %>% pull(asa_rating_c) %>% table()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n.\n    1     2     3     4     5     6 \n 2085 12515 20943  4587   470    21 \n```\n:::\n:::\n\n\n## Exaplanatory variables\n\nWe define two stes of explanatory variables. One based only on patient information and another that also includes LDA information:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndependent = \"respiratory_comp\"\n\n# Basic patient information\nbasic_features = c(\n  #\"icu_admin_flag\",\n  \"age\",\n  \"height_cm\",\n  \"weight\",\n  \"sex\",\n  \"primary_anes_type_nm\",\n  \"asa_rating_c\",\n  \"patient_class_group\"\n)\n\n\n# Lines and drains\nlda_features = c(\n  \"piv_line\",\n  \"wound\",\n  \"urinary_drainage\",           \n  \"art_line\",\n  \"airway\",\n  \"cvc_line\",\n  \"drain\",\n  \"wound_therapy\",\n  \"picc_line\",\n  \"pressure_ulcer_injury\",\n  \"line_type\",\n  \"nasogastric_orogastric_tube\",\n  \"extravasation\",\n  \"epidural_line\",\n  \"intraosseous_line\"\n)\n\n# Medicines\nmed_features = data_train %>% \n  select(starts_with(\"med_\")) %>% \n  names()\n\n# Labs (any abnomality)\nlab_features_any = data_train %>% \n  select(ends_with(\"_any\")) %>% \n  names()\n\n# Labs (extreme abnomality)\nlab_features_ext = data_train %>% \n  select(ends_with(\"_ext\")) %>% \n  names()\n\n# Sets of explanatory variables\nindependent_basic = basic_features\nindependent_basic_lda = c(basic_features, lda_features)\nindependent_basic_lda_med = c(basic_features, lda_features, med_features)\nindependent_basic_lda_med_lab_any = c(basic_features, lda_features, med_features, lab_features_any)\nindependent_basic_lda_med_lab_ext = c(basic_features, lda_features, med_features, lab_features_ext)\n```\n:::\n\n\nSummary table, by respiratory complications:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_train %>% summary_factorlist(dependent = dependent, explanatory = independent_basic_lda_med) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-81b86f7d40c386dfa9e6\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-81b86f7d40c386dfa9e6\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"age\",\"height_cm\",\"weight\",\"sex\",\"\",\"primary_anes_type_nm\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"asa_rating_c\",\"\",\"\",\"\",\"\",\"\",\"patient_class_group\",\"\",\"piv_line\",\"wound\",\"urinary_drainage\",\"art_line\",\"airway\",\"cvc_line\",\"drain\",\"wound_therapy\",\"picc_line\",\"pressure_ulcer_injury\",\"line_type\",\"nasogastric_orogastric_tube\",\"\",\"\",\"\",\"extravasation\",\"\",\"\",\"epidural_line\",\"intraosseous_line\",\"\",\"med_acetaminophen\",\"med_cefazolin_sodium\",\"med_dexamethasone_sodium_phosphate\",\"med_heparin\",\"med_heparin_sodium_porcine\",\"med_lidocaine\",\"med_ondansetron_hcl\",\"med_phenylephrine_dilution\",\"med_propofol_diprivan\",\"med_sodium_chloride\",\"med_bacitracin\",\"med_dextrose_nacl\",\"med_ephedrine_sulfate\",\"med_fentanyl_citrate_pf\",\"med_hydromorphone_hcl\",\"med_lidocaine_epinephrine\",\"med_plasma_lyte_a_iv_soln\",\"med_povidone_iodine\",\"med_rocuronium_bromide\",\"med_sodium_chloride_flush\",\"med_sugammadex_sodium\",\"med_albumin_human\",\"med_cefazolin_sodium_dextrose\",\"med_glycopyrrolate\",\"med_iohexol\",\"med_midazolam_hcl\",\"med_neostigmine_methylsulfate\",\"med_dextrose\",\"med_docusate_sodium\",\"med_enoxaparin_sodium\",\"med_glucagon_hcl_diagnostic\",\"med_lidocaine_hcl\",\"med_magnesium_sulfate\",\"med_senna\",\"med_lactated_ringers_iv_soln\",\"med_propofol\",\"med_gabapentin\",\"med_succinylcholine_chloride\",\"med_oxycodone_hcl\",\"med_insulin_lispro_human\"],[\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Female\",\"Male\",\"Epidural\",\"General\",\"Local\",\"moderate_sedation\",\"monitored_anesthesia_care\",\"None\",\"patient_choice_on_day\",\"Regional\",\"Spinal\",\"Topical\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"Inpatient\",\"Outpatient\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"0\",\"1\",\"2\",\"3\",\"0\",\"1\",\"2\",\"Mean (SD)\",\"0\",\"1\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\"],[\"55.2 (17.5)\",\"168.4 (10.8)\",\"2786.9 (771.1)\",\"20880 (46.9)\",\"23681 (53.1)\",\"222 (0.5)\",\"36047 (80.9)\",\"248 (0.6)\",\"2419 (5.4)\",\"3473 (7.8)\",\"155 (0.3)\",\"22 (0.0)\",\"1869 (4.2)\",\"84 (0.2)\",\"2 (0.0)\",\"2081 (5.2)\",\"12475 (31.0)\",\"20736 (51.5)\",\"4485 (11.1)\",\"455 (1.1)\",\"21 (0.1)\",\"29123 (65.4)\",\"15438 (34.6)\",\"1.9 (2.1)\",\"1.9 (2.9)\",\"0.7 (0.9)\",\"0.1 (0.5)\",\"0.1 (0.5)\",\"0.2 (0.7)\",\"1.9 (3.5)\",\"0.1 (0.7)\",\"0.1 (0.3)\",\"0.1 (0.6)\",\"0.1 (0.4)\",\"44406 (99.7)\",\"142 (0.3)\",\"12 (0.0)\",\"1 (0.0)\",\"44530 (99.9)\",\"30 (0.1)\",\"1 (0.0)\",\"0.0 (0.2)\",\"44554 (100.0)\",\"7 (0.0)\",\"4.6 (14.0)\",\"0.6 (1.1)\",\"1.1 (2.3)\",\"2.3 (20.0)\",\"1.8 (8.6)\",\"1.4 (6.7)\",\"2.2 (4.7)\",\"2.5 (4.8)\",\"3.1 (8.3)\",\"5.6 (23.9)\",\"0.9 (6.9)\",\"2.8 (10.6)\",\"1.1 (1.9)\",\"3.8 (4.7)\",\"2.4 (7.9)\",\"0.2 (0.5)\",\"3.6 (4.5)\",\"2.2 (7.0)\",\"2.7 (3.7)\",\"2.0 (12.9)\",\"0.4 (0.7)\",\"0.7 (2.7)\",\"0.5 (2.6)\",\"0.5 (1.4)\",\"0.5 (1.2)\",\"1.0 (1.9)\",\"0.3 (0.6)\",\"3.4 (11.5)\",\"2.1 (7.9)\",\"1.5 (7.1)\",\"0.7 (2.0)\",\"1.2 (4.2)\",\"0.6 (2.7)\",\"2.3 (7.9)\",\"1.1 (5.6)\",\"4.6 (22.3)\",\"2.4 (11.9)\",\"0.3 (0.6)\",\"2.7 (13.2)\",\"4.7 (22.8)\"],[\"56.1 (16.6)\",\"170.1 (11.1)\",\"3133.1 (965.2)\",\"154 (38.0)\",\"251 (62.0)\",\"1 (0.2)\",\"338 (83.5)\",\"3 (0.7)\",\"14 (3.5)\",\"37 (9.1)\",\"0 (0.0)\",\"1 (0.2)\",\"11 (2.7)\",\"0 (0.0)\",\"0 (0.0)\",\"4 (1.1)\",\"40 (10.9)\",\"207 (56.2)\",\"102 (27.7)\",\"15 (4.1)\",\"0 (0.0)\",\"326 (80.5)\",\"79 (19.5)\",\"3.1 (2.7)\",\"4.7 (6.3)\",\"2.4 (5.0)\",\"0.2 (0.6)\",\"0.4 (0.9)\",\"0.4 (0.9)\",\"7.3 (11.5)\",\"1.5 (4.3)\",\"0.3 (0.5)\",\"0.2 (0.5)\",\"0.1 (0.4)\",\"403 (99.5)\",\"2 (0.5)\",\"0 (0.0)\",\"0 (0.0)\",\"402 (99.3)\",\"3 (0.7)\",\"0 (0.0)\",\"0.0 (0.3)\",\"405 (100.0)\",\"0 (0.0)\",\"14.8 (32.6)\",\"1.6 (3.8)\",\"2.6 (6.1)\",\"2.1 (9.7)\",\"7.3 (21.4)\",\"3.4 (11.7)\",\"5.5 (10.5)\",\"6.0 (8.4)\",\"7.2 (14.1)\",\"29.3 (77.5)\",\"2.0 (6.9)\",\"7.4 (17.9)\",\"2.3 (5.6)\",\"7.0 (10.9)\",\"6.2 (18.4)\",\"0.2 (0.5)\",\"7.8 (15.9)\",\"6.2 (9.9)\",\"5.7 (8.6)\",\"5.6 (13.9)\",\"1.0 (2.4)\",\"1.3 (2.7)\",\"0.8 (3.2)\",\"0.9 (2.3)\",\"1.9 (3.4)\",\"2.5 (5.5)\",\"0.5 (0.9)\",\"8.1 (20.4)\",\"13.1 (39.6)\",\"5.3 (16.5)\",\"1.4 (3.0)\",\"5.7 (14.0)\",\"1.1 (2.6)\",\"10.4 (25.9)\",\"5.6 (17.6)\",\"19.4 (49.4)\",\"5.7 (20.4)\",\"0.9 (1.8)\",\"23.0 (77.1)\",\"7.2 (23.3)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>label<\\/th>\\n      <th>levels<\\/th>\\n      <th>No<\\/th>\\n      <th>Yes<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nSummary of basic information by death:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_train %>% summary_factorlist(dependent = \"death\", \n                                  explanatory = independent_basic,\n                                  p=TRUE) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-bfd3a0f667cc222e3dc6\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-bfd3a0f667cc222e3dc6\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"age\",\"height_cm\",\"weight\",\"sex\",\"\",\"primary_anes_type_nm\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"asa_rating_c\",\"\",\"\",\"\",\"\",\"\",\"patient_class_group\",\"\"],[\"Mean (SD)\",\"Mean (SD)\",\"Mean (SD)\",\"Female\",\"Male\",\"Epidural\",\"General\",\"Local\",\"moderate_sedation\",\"monitored_anesthesia_care\",\"None\",\"patient_choice_on_day\",\"Regional\",\"Spinal\",\"Topical\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"Inpatient\",\"Outpatient\"],[\"55.1 (17.5)\",\"168.4 (10.8)\",\"2789.5 (773.3)\",\"20795 (47.0)\",\"23476 (53.0)\",\"222 (0.5)\",\"35797 (80.9)\",\"245 (0.6)\",\"2387 (5.4)\",\"3472 (7.8)\",\"154 (0.3)\",\"23 (0.1)\",\"1867 (4.2)\",\"84 (0.2)\",\"2 (0.0)\",\"2085 (5.2)\",\"12506 (31.2)\",\"20824 (52.0)\",\"4317 (10.8)\",\"308 (0.8)\",\"2 (0.0)\",\"28760 (65.0)\",\"15511 (35.0)\"],[\"58.4 (18.1)\",\"167.6 (10.8)\",\"2822.6 (807.9)\",\"236 (34.1)\",\"456 (65.9)\",\"1 (0.1)\",\"586 (84.9)\",\"5 (0.7)\",\"46 (6.7)\",\"38 (5.5)\",\"1 (0.1)\",\"0 (0.0)\",\"13 (1.9)\",\"0 (0.0)\",\"0 (0.0)\",\"0 (0.0)\",\"9 (1.6)\",\"119 (20.6)\",\"269 (46.5)\",\"162 (28.0)\",\"19 (3.3)\",\"686 (99.1)\",\"6 (0.9)\"],[\"&lt;0.001\",\"0.043\",\"0.266\",\"&lt;0.001\",\"\",\"0.010\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"&lt;0.001\",\"\",\"\",\"\",\"\",\"\",\"&lt;0.001\",\"\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>label<\\/th>\\n      <th>levels<\\/th>\\n      <th>Alive<\\/th>\\n      <th>Died<\\/th>\\n      <th>p<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Fit lasso-regularized logistic regression model\n\nThe following function is used to fit logistic regression models.\n\nWe model the following dependent variables:\n\n- respitatory complications\n\n- Death\n\n- low SPO2 (intra-operative)\n\n- low SPO2 (post-operative)\n\nThese are modeled on the following sets of independent variables:\n\n- Basic patient info (from \"Patient Information\")\n\n- Lines and drains (from \"Patient LDA\")\n\n- Medications (from \"Patient Medications\")\n\n- Labs (from \"Patient Labs\")\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function for fitting LR models\n\nfit_LR = function(dependent, independent){\n  \n  # For dynamically defining model formula\n  d  <- rlang::sym(dependent)\n  f <- as.formula(paste(d, \" ~ .\"))\n  \n  out = sets_train %>%   # Model fit on imputed training sets\n  complete(\"all\") %>% \n  map(function(.x){\n    \n    # Define X and y\n    .x %>% \n      select(dependent, all_of(independent) ) %>% \n      filter((asa_rating_c != 5) & (asa_rating_c != 6)) %>% \n      drop_na() %>% \n      recipes::recipe(\n        formula = f) %>% \n      step_normalize(all_numeric()) %>% \n      step_dummy(all_nominal(), -!!sym(dependent)) %>%\n      step_naomit(everything()) %>% \n      prep() %>% \n      juice() %T>%\n      {X <<- select(., -!!sym(dependent)) %>% as.matrix()} %>% \n      {y <<- pull(., !!sym(dependent)) %>% as.numeric() %>% {. - 1}}\n    \n    # Fit\n    fits = glmnet(X, y, \n                  family = \"binomial\", maxit = 4000, \n                  standardize = T)\n    \n    # K-fold CV, nfolds = 10\n    cv.fits = cv.glmnet(X, y, standardize = TRUE,\n                        family = \"binomial\", maxit = 4000,\n                        type.measure = \"auc\")\n    \n    # Optimal regularization strength\n    #opt.lam = c(cv.fits$lambda.min, cv.fits$lambda.1se)\n    opt.lam = cv.fits$lambda.min\n    \n    list(\"fit\" = fits, \n         \"cv\" = cv.fits, \n         \"opt.lam\" = opt.lam)\n  }\n  )\n  out\n}\n```\n:::\n\n\nFit models for respiratory complications, death and SPO2 on various subsets of independent variables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# models predicting respiratory complications\n#---------------------------------------------\nlasso_out_basic = fit_LR(\"respiratory_comp\", independent_basic)\nlasso_out_basic %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic.rds\")\n\nlasso_out_basic_lda = fit_LR(\"respiratory_comp\", independent_basic_lda)\nlasso_out_basic_lda %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda.rds\")\n\nlasso_out_basic_lda_med = fit_LR(\"respiratory_comp\", independent_basic_lda_med)\nlasso_out_basic_lda_med %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med.rds\")\n\nlasso_out_basic_lda_med_lab_any = fit_LR(\"respiratory_comp\", independent_basic_lda_med_lab_any)\nlasso_out_basic_lda_med_lab_any %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_any.rds\")\n\nlasso_out_basic_lda_med_lab_ext = fit_LR(\"respiratory_comp\", independent_basic_lda_med_lab_ext)\nlasso_out_basic_lda_med_lab_ext %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_ext.rds\")\n\n\n# Models of death\n#----------------\nlasso_out_basic = fit_LR(\"death\", independent_basic)\nlasso_out_basic %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_death.rds\")\n\nlasso_out_basic_lda = fit_LR(\"death\", independent_basic_lda)\nlasso_out_basic_lda %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_death.rds\")\n\nlasso_out_basic_lda_med = fit_LR(\"death\", independent_basic_lda_med)\nlasso_out_basic_lda_med %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_death.rds\")\n\nlasso_out_basic_lda_med_lab_any = fit_LR(\"death\", independent_basic_lda_med_lab_any)\nlasso_out_basic_lda_med_lab_any %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_any_death.rds\")\n\nlasso_out_basic_lda_med_lab_ext = fit_LR(\"death\", independent_basic_lda_med_lab_ext)\nlasso_out_basic_lda_med_lab_ext %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_ext_death.rds\")\n\n\n\n#models of sp02\n#--------------\n\nlasso_out_basic = fit_LR(\"spo2_intra90\", independent_basic)\nlasso_out_basic %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_spo2.rds\")\n\nlasso_out_basic_lda = fit_LR(\"spo2_intra90\", independent_basic_lda)\nlasso_out_basic_lda %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_spo2.rds\")\n\nlasso_out_basic_lda_med = fit_LR(\"spo2_intra90\", independent_basic_lda_med)\nlasso_out_basic_lda_med %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_spo2.rds\")\n\nlasso_out_basic_lda_med_lab_any = fit_LR(\"spo2_intra90\", independent_basic_lda_med_lab_any)\nlasso_out_basic_lda_med_lab_any %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_any_spo2.rds\")\n\nlasso_out_basic_lda_med_lab_ext = fit_LR(\"spo2_intra90\", independent_basic_lda_med_lab_ext)\nlasso_out_basic_lda_med_lab_ext %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_ext_spo2.rds\")\n\n\n#models of sp02 post\n#-------------------\n\nlasso_out_basic = fit_LR(\"spo2_post90\", independent_basic)\nlasso_out_basic %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_spo2_post.rds\")\n\nlasso_out_basic_lda = fit_LR(\"spo2_post90\", independent_basic_lda)\nlasso_out_basic_lda %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_spo2_post.rds\")\n\nlasso_out_basic_lda_med = fit_LR(\"spo2_post90\", independent_basic_lda_med)\nlasso_out_basic_lda_med %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_spo2_post.rds\")\n\nlasso_out_basic_lda_med_lab_any = fit_LR(\"spo2_post90\", independent_basic_lda_med_lab_any)\nlasso_out_basic_lda_med_lab_any %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_any_spo2_post.rds\")\n\nlasso_out_basic_lda_med_lab_ext = fit_LR(\"spo2_post90\", independent_basic_lda_med_lab_ext)\nlasso_out_basic_lda_med_lab_ext %>% \n  write_rds(\"/home/common/mover_data/results/baseline_model/lasso_out_basic_lda_med_lab_ext_spo2_post.rds\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n# The cross-validated performance per regularization strength\n\n## Respiratory complications\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Death\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n## SPO2 (intra-op)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n## SPO2 (post-op)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n# Retained variables\n\nHere we show the independent variables that would be selected by majority rule by the lasso. We show only the basic+lda_med+labs(any) models for each dependent variable (respiratory complications, death, SPO2 (intra and post op)).\n\n## Respiratory complications\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlasso_out_basic_lda_med_lab_any_rc %>% \n  map(function(fit){\n    fit$fit %>% \n      coef(s=fit$opt.lam) %>% \n      as.matrix() %>% \n      as.data.frame()\n  }) %>% \n  bind_cols() %>%\n  rownames_to_column(\"row_names\") %>% \n  rowwise() %>%\n  mutate(frac_zero = sum(c_across(-row_names ) == 0)/(ncol(.)-1) ) %>% \n  filter(frac_zero<0.5) %>% \n  select(-frac_zero) %>% \n  rowwise() %>%\n  mutate(pooled_coef = mean(c_across(-all_of(c(\"row_names\")) ))) %>% \n  select(row_names, pooled_coef) %>% \n  arrange(pooled_coef) %>% \n  mutate(row_names = lab_name_map(row_names)) %>% \n  dplyr::rename(\"variable\" = \"row_names\") %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-c25d276a443957081fd3\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c25d276a443957081fd3\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-5.93729901154268\\\" data-max=\\\"1.18649090893789\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"(Intercept)\",\"primary_anes_type_nm_moderate_sedation\",\"med_magnesium_sulfate\",\"LAB_Platelet_mean_volume\",\"primary_anes_type_nm_Local\",\"med_enoxaparin_sodium\",\"asa_rating_c_X2\",\"med_heparin\",\"med_plasma_lyte_a_iv_soln\",\"pressure_ulcer_injury\",\"LAB_Hematocrit\",\"art_line\",\"med_glucagon_hcl_diagnostic\",\"med_fentanyl_citrate_pf\",\"med_cefazolin_sodium_dextrose\",\"med_lidocaine_epinephrine\",\"cvc_line\",\"med_ondansetron_hcl\",\"med_midazolam_hcl\",\"line_type\",\"intraosseous_line\",\"age\",\"picc_line\",\"med_sodium_chloride\",\"extravasation\",\"epidural_line\",\"med_lidocaine\",\"med_lactated_ringers_iv_soln\",\"LAB_Microorganism_identified\",\"med_phenylephrine_dilution\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin\",\"wound_therapy\",\"med_dexamethasone_sodium_phosphate\",\"med_succinylcholine_chloride\",\"drain\",\"urinary_drainage\",\"med_hydromorphone_hcl\",\"med_iohexol\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.non_black\",\"airway\",\"med_cefazolin_sodium\",\"sex_Male\",\"med_oxycodone_hcl\",\"LAB_Creatinine\",\"primary_anes_type_nm_monitored_anesthesia_care\",\"LAB_Potassium\",\"weight\",\"LAB_Chloride\",\"LAB_Urea_nitrogen\",\"asa_rating_c_X4\",\"LAB_Erythrocyte_distribution_width\",\"primary_anes_type_nm_patient_choice_on_day\"],[-5.937299011542676,-0.3567633572009855,-0.2937457124079145,-0.2902557337349256,-0.2691162164310764,-0.2577731641502186,-0.2237105907432276,-0.2217542777590722,-0.1613488534459439,-0.1608747948947962,-0.1574957598191464,-0.1252462831539051,-0.1078841607957493,-0.05577257389909372,-0.05187041421895311,-0.04907253276721491,-0.03767265140015141,-0.02365884846561255,-0.01090721175069653,-0.009897974026738133,-0.00718294429780587,0.0136738064152584,0.01540555166545755,0.02176375310848474,0.03006698780030978,0.03316023190415786,0.03537283395571373,0.0583145166676198,0.07205749248363362,0.08770905535861434,0.09008054060779444,0.09454866625250127,0.09551994395449573,0.1085098314110928,0.1113892682196985,0.115861060574445,0.1191492626624881,0.1258540248213129,0.1400585408526077,0.1417424843748937,0.144641196758761,0.1695810440355503,0.1878914878417756,0.1883996397218404,0.1961993566188938,0.2033604368551484,0.2296451236321835,0.3118513533801363,0.3133839559554532,0.369141062062524,0.5403843636701547,1.186490908937893]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>variable<\\/th>\\n      <th>pooled_coef<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Death\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlasso_out_basic_lda_med_lab_any_death %>% \n  map(function(fit){\n    fit$fit %>% \n      coef(s=fit$opt.lam) %>% \n      as.matrix() %>% \n      as.data.frame()\n  }) %>% \n  bind_cols() %>%\n  rownames_to_column(\"row_names\") %>% \n  rowwise() %>%\n  mutate(frac_zero = sum(c_across(-row_names ) == 0)/(ncol(.)-1) ) %>% \n  filter(frac_zero<0.5) %>% \n  select(-frac_zero) %>% \n  rowwise() %>%\n  mutate(pooled_coef = mean(c_across(-all_of(c(\"row_names\")) ))) %>% \n  select(row_names, pooled_coef) %>% \n  arrange(pooled_coef) %>% \n  mutate(row_names = lab_name_map(row_names)) %>% \n  dplyr::rename(\"variable\" = \"row_names\") %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-5b595207933859fbd4c7\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5b595207933859fbd4c7\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-12.1060595819376\\\" data-max=\\\"1.55083822946318\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"(Intercept)\",\"primary_anes_type_nm_Topical\",\"primary_anes_type_nm_patient_choice_on_day\",\"primary_anes_type_nm_None\",\"patient_class_group_Outpatient\",\"primary_anes_type_nm_Local\",\"primary_anes_type_nm_Spinal\",\"urinary_drainage\",\"height_cm\",\"LAB_Urea_nitrogen\",\"asa_rating_c_X3\",\"primary_anes_type_nm_moderate_sedation\",\"piv_line\",\"med_neostigmine_methylsulfate\",\"med_ephedrine_sulfate\",\"med_hydromorphone_hcl\",\"epidural_line\",\"med_midazolam_hcl\",\"med_sugammadex_sodium\",\"med_rocuronium_bromide\",\"nasogastric_orogastric_tube\",\"med_fentanyl_citrate_pf\",\"med_sodium_chloride_flush\",\"med_senna\",\"med_bacitracin\",\"med_lidocaine\",\"med_acetaminophen\",\"med_gabapentin\",\"med_cefazolin_sodium_dextrose\",\"med_propofol\",\"primary_anes_type_nm_Regional\",\"picc_line\",\"med_succinylcholine_chloride\",\"med_heparin\",\"cvc_line\",\"extravasation\",\"med_heparin_sodium_porcine\",\"med_insulin_lispro_human\",\"med_iohexol\",\"wound\",\"med_sodium_chloride\",\"med_enoxaparin_sodium\",\"wound_therapy\",\"med_cefazolin_sodium\",\"med_ondansetron_hcl\",\"med_povidone_iodine\",\"med_oxycodone_hcl\",\"med_glycopyrrolate\",\"med_lidocaine_epinephrine\",\"med_dextrose\",\"med_dextrose_nacl\",\"med_lidocaine_hcl\",\"med_magnesium_sulfate\",\"med_propofol_diprivan\",\"pressure_ulcer_injury\",\"med_lactated_ringers_iv_soln\",\"primary_anes_type_nm_monitored_anesthesia_care\",\"med_glucagon_hcl_diagnostic\",\"med_albumin_human\",\"med_dexamethasone_sodium_phosphate\",\"line_type\",\"med_docusate_sodium\",\"LAB_Chloride\",\"LAB_Creatinine\",\"airway\",\"LAB_Erythrocyte_mean_corpuscular_volume\",\"art_line\",\"primary_anes_type_nm_General\",\"weight\",\"med_phenylephrine_dilution\",\"LAB_Erythrocytes\",\"drain\",\"LAB_Calcium\",\"LAB_Leukocytes^^corrected_for_nucleated_erythrocytes\",\"LAB_Platelet_mean_volume\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin\",\"asa_rating_c_X4\",\"LAB_Sodium\",\"sex_Male\",\"LAB_Platelets\",\"age\",\"LAB_Potassium\",\"LAB_Erythrocyte_distribution_width\",\"LAB_Microorganism_identified\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.black\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin_concentration\",\"LAB_Hemoglobin\",\"LAB_Hematocrit\",\"LAB_Anion_gap\",\"LAB_Carbon_dioxide\",\"LAB_Glucose\"],[-12.10605958193761,-1.44017476661783,-1.222891069801617,-1.08553628348473,-1.064578958705866,-0.7779548243683906,-0.5977472201404799,-0.3761794614405454,-0.3391132030450351,-0.3355463824079898,-0.3206092943035631,-0.2596487415182334,-0.2441369229100966,-0.1703975853922754,-0.1513009698286864,-0.1436582992436332,-0.1409001313732572,-0.1244122639668908,-0.1213694096978007,-0.1198502631553484,-0.1180504797439804,-0.1173636277569422,-0.1076957654327237,-0.10184058824896,-0.09785086349797886,-0.0958070698014559,-0.07901932216321531,-0.06691259566717984,-0.0611014544790341,-0.04755404618038229,-0.04671675350550013,-0.04500794176591787,-0.03798777870874432,-0.03610516167347168,-0.01900920362991763,-0.01650042186660523,-0.01471105804159536,-0.01470236118002386,-0.01347062434786975,-0.01098194399731365,0.003917510069162022,0.005448829563695063,0.006214755916122902,0.006967823457407286,0.01669007546350246,0.01712299486929311,0.03248343782511977,0.03314672757053154,0.0364434279568823,0.04159684463132297,0.04262516310162221,0.04498835305767233,0.04903289847337369,0.0498306276288759,0.05037905718106989,0.05266462017047758,0.06235302568061811,0.06284058923218976,0.06672243222724537,0.0704467528933785,0.08929647127307992,0.09172315177457525,0.1142770005184577,0.1166991474438886,0.1291609620455572,0.1338720714489435,0.1513210147730752,0.1549667179456401,0.1675280412030765,0.182739025013022,0.2116326688583195,0.2128369657513845,0.2165894937305073,0.221243741361812,0.2348658437374125,0.2464828884198174,0.2478463535992504,0.2832003086632809,0.3243286485998277,0.3326636676700174,0.3365458025818955,0.4643680642755483,0.4747975335021347,0.5112659271018561,0.5365985934416108,0.6676854158475376,0.7128287022311545,0.8293674415139426,1.080780734940904,1.151052251477319,1.550838229463178]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>variable<\\/th>\\n      <th>pooled_coef<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## SPO2 (intra-op)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlasso_out_basic_lda_med_lab_any_spo2 %>% \n  map(function(fit){\n    fit$fit %>% \n      coef(s=fit$opt.lam) %>% \n      as.matrix() %>% \n      as.data.frame()\n  }) %>% \n  bind_cols() %>%\n  rownames_to_column(\"row_names\") %>% \n  rowwise() %>%\n  mutate(frac_zero = sum(c_across(-row_names ) == 0)/(ncol(.)-1) ) %>% \n  filter(frac_zero<0.5) %>% \n  select(-frac_zero) %>% \n  rowwise() %>%\n  mutate(pooled_coef = mean(c_across(-all_of(c(\"row_names\")) ))) %>% \n  select(row_names, pooled_coef) %>% \n  arrange(pooled_coef) %>% \n  mutate(row_names = lab_name_map(row_names)) %>% \n  dplyr::rename(\"variable\" = \"row_names\") %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-88c8254d13c07cbca631\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-88c8254d13c07cbca631\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-3.58509541578237\\\" data-max=\\\"1.2953862777882\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"primary_anes_type_nm_Local\",\"primary_anes_type_nm_moderate_sedation\",\"primary_anes_type_nm_patient_choice_on_day\",\"(Intercept)\",\"primary_anes_type_nm_None\",\"sex_Male\",\"patient_class_group_Outpatient\",\"med_neostigmine_methylsulfate\",\"LAB_Hematocrit\",\"med_heparin_sodium_porcine\",\"med_ephedrine_sulfate\",\"picc_line\",\"wound_therapy\",\"med_dextrose_nacl\",\"height_cm\",\"med_insulin_lispro_human\",\"med_fentanyl_citrate_pf\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.black\",\"med_bacitracin\",\"med_propofol\",\"urinary_drainage\",\"LAB_Erythrocyte_mean_corpuscular_volume\",\"med_plasma_lyte_a_iv_soln\",\"med_lactated_ringers_iv_soln\",\"epidural_line\",\"med_sodium_chloride\",\"med_iohexol\",\"med_dexamethasone_sodium_phosphate\",\"LAB_Urea_nitrogen\",\"med_lidocaine_hcl\",\"pressure_ulcer_injury\",\"med_enoxaparin_sodium\",\"age\",\"med_midazolam_hcl\",\"LAB_Glucose\",\"wound\",\"med_rocuronium_bromide\",\"med_albumin_human\",\"nasogastric_orogastric_tube\",\"med_cefazolin_sodium_dextrose\",\"med_propofol_diprivan\",\"extravasation\",\"med_sugammadex_sodium\",\"art_line\",\"med_heparin\",\"med_hydromorphone_hcl\",\"intraosseous_line\",\"med_lidocaine\",\"LAB_Microorganism_identified\",\"piv_line\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.non_black\",\"LAB_Chloride\",\"med_lidocaine_epinephrine\",\"med_sodium_chloride_flush\",\"med_senna\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin_concentration\",\"LAB_Carbon_dioxide\",\"med_succinylcholine_chloride\",\"LAB_Erythrocyte_distribution_width\",\"med_cefazolin_sodium\",\"LAB_Calcium\",\"med_phenylephrine_dilution\",\"LAB_Platelet_mean_volume\",\"LAB_Potassium\",\"LAB_Sodium\",\"LAB_Leukocytes^^corrected_for_nucleated_erythrocytes\",\"line_type\",\"primary_anes_type_nm_monitored_anesthesia_care\",\"drain\",\"LAB_Anion_gap\",\"LAB_Platelets\",\"LAB_Erythrocytes\",\"primary_anes_type_nm_Spinal\",\"asa_rating_c_X3\",\"weight\",\"asa_rating_c_X4\",\"primary_anes_type_nm_Topical\"],[-3.585095415782367,-2.956010963905012,-2.218008082350487,-1.661488946107872,-0.4820182295902298,-0.2735346222850373,-0.2589765282708157,-0.09526270248046738,-0.09009716578739611,-0.07328575524711008,-0.04782174913444002,-0.04367145670112871,-0.03856552694789825,-0.03380777855386717,-0.03191755632789549,-0.02802104018270037,-0.02561940430996103,-0.02415893547783616,-0.02338498981677749,-0.02020924221794065,-0.01996839488024214,-0.0199154939418737,-0.01633335100527154,-0.01419386019652706,-0.01252472415021988,-0.01240175869247587,-0.01144438291060926,-0.01123145326728059,-0.01106833141350899,-0.008086292952607514,-0.006085737555203564,-0.005038058915524218,-0.003124050733547572,-0.001847027670648404,-0.0001946288302679267,0.002815024909575419,0.003018018189017408,0.003447185906184549,0.003785960669344748,0.004244278445302291,0.004550380334149018,0.004843417070423187,0.004935893953795168,0.006989956791249833,0.007262079400854385,0.009754563789644745,0.01064166107925939,0.01446786042020649,0.01476653260129741,0.01779692011509476,0.01924000349779894,0.02627687433302539,0.03023459698926291,0.03132450617176871,0.03572158913079929,0.03625412135432259,0.04815714401335461,0.05607189672479067,0.05827029059857555,0.0632859858872606,0.06816222772576062,0.06961971854231161,0.06974462633534953,0.07470317188250923,0.08014343085367492,0.08222354154273222,0.08532092133978735,0.09353503547583861,0.09717245703716051,0.1104419186804151,0.1392071489895834,0.1825902028146884,0.2023879514913052,0.2598491895986201,0.2676397205401786,0.7525303045558692,1.295386277788199]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>variable<\\/th>\\n      <th>pooled_coef<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## SPO2 (post-op)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlasso_out_basic_lda_med_lab_any_spo2p %>% \n  map(function(fit){\n    fit$fit %>% \n      coef(s=fit$opt.lam) %>% \n      as.matrix() %>% \n      as.data.frame()\n  }) %>% \n  bind_cols() %>%\n  rownames_to_column(\"row_names\") %>% \n  rowwise() %>%\n  mutate(frac_zero = sum(c_across(-row_names ) == 0)/(ncol(.)-1) ) %>% \n  filter(frac_zero<0.5) %>% \n  select(-frac_zero) %>% \n  rowwise() %>%\n  mutate(pooled_coef = mean(c_across(-all_of(c(\"row_names\")) ))) %>% \n  select(row_names, pooled_coef) %>% \n  arrange(pooled_coef) %>% \n  mutate(row_names = lab_name_map(row_names)) %>% \n  dplyr::rename(\"variable\" = \"row_names\") %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-83e74b94ee3488cd89fa\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-83e74b94ee3488cd89fa\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-3.03243946970659\\\" data-max=\\\"1.53819798140506\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"(Intercept)\",\"primary_anes_type_nm_Topical\",\"patient_class_group_Outpatient\",\"primary_anes_type_nm_Spinal\",\"primary_anes_type_nm_General\",\"sex_Male\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.black\",\"med_enoxaparin_sodium\",\"med_succinylcholine_chloride\",\"med_acetaminophen\",\"pressure_ulcer_injury\",\"med_lidocaine_epinephrine\",\"med_plasma_lyte_a_iv_soln\",\"med_senna\",\"med_sodium_chloride\",\"med_lidocaine_hcl\",\"med_cefazolin_sodium\",\"extravasation\",\"med_propofol\",\"med_heparin\",\"med_magnesium_sulfate\",\"med_lidocaine\",\"height_cm\",\"med_dextrose_nacl\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin\",\"med_cefazolin_sodium_dextrose\",\"med_bacitracin\",\"med_insulin_lispro_human\",\"line_type\",\"med_midazolam_hcl\",\"intraosseous_line\",\"med_povidone_iodine\",\"med_phenylephrine_dilution\",\"LAB_Creatinine\",\"med_propofol_diprivan\",\"med_dexamethasone_sodium_phosphate\",\"med_ondansetron_hcl\",\"med_sugammadex_sodium\",\"med_glycopyrrolate\",\"LAB_Microorganism_identified\",\"med_albumin_human\",\"art_line\",\"med_gabapentin\",\"med_heparin_sodium_porcine\",\"med_oxycodone_hcl\",\"LAB_Erythrocyte_mean_corpuscular_volume\",\"nasogastric_orogastric_tube\",\"wound_therapy\",\"LAB_Anion_gap\",\"LAB_Hemoglobin\",\"med_glucagon_hcl_diagnostic\",\"med_hydromorphone_hcl\",\"urinary_drainage\",\"med_iohexol\",\"med_sodium_chloride_flush\",\"airway\",\"cvc_line\",\"LAB_Glomerular_filtration_rate/1.73_sq_M.predicted.non_black\",\"LAB_Glucose\",\"LAB_Urea_nitrogen\",\"epidural_line\",\"LAB_Potassium\",\"picc_line\",\"piv_line\",\"LAB_Leukocytes^^corrected_for_nucleated_erythrocytes\",\"age\",\"LAB_Erythrocyte_mean_corpuscular_hemoglobin_concentration\",\"LAB_Calcium\",\"weight\",\"drain\",\"wound\",\"primary_anes_type_nm_Regional\",\"LAB_Chloride\",\"LAB_Carbon_dioxide\",\"LAB_Platelet_mean_volume\",\"LAB_Platelets\",\"asa_rating_c_X2\",\"LAB_Hematocrit\",\"primary_anes_type_nm_patient_choice_on_day\",\"LAB_Sodium\",\"LAB_Erythrocyte_distribution_width\",\"LAB_Erythrocytes\",\"asa_rating_c_X3\",\"asa_rating_c_X4\",\"primary_anes_type_nm_moderate_sedation\",\"primary_anes_type_nm_Local\",\"primary_anes_type_nm_None\"],[-3.032439469706586,-1.149804624362542,-0.2203178208525719,-0.1319095347400479,-0.08475470826032459,-0.08349526258822587,-0.06188462469105293,-0.05988408798612881,-0.05653508669240891,-0.05410343660439849,-0.04988633455840829,-0.04559860101063912,-0.03093188095456478,-0.02985672240289756,-0.02859922750531675,-0.0282672818509977,-0.02777380223278508,-0.02755269235557605,-0.02123009506966872,-0.01889996902003825,-0.01843883747836352,-0.0184053638246523,-0.01703487965403921,-0.0126103031937262,-0.01189212518696707,-0.01112217087979611,-0.01064375793019059,-0.009292987411772738,-0.006073620925133029,-0.004896861153677765,-0.003833978613614877,-0.002166610836916284,-0.001801227775218683,0.003690045789660024,0.004384280762309184,0.005668959329572173,0.006400705632933635,0.008451981025294172,0.009345171085035733,0.009358567602630815,0.0105611944624813,0.01076670741462343,0.01099210009232105,0.01433356450560282,0.01475524205407599,0.01529114398658227,0.01536540767413769,0.01847283227545195,0.02000538129531782,0.02257887304776415,0.02261197512767112,0.02502169091103225,0.02603616165996626,0.03851531951121998,0.04198256069156921,0.04210220142557938,0.04293701350196655,0.04630935521431075,0.04767436428163633,0.04821975643608777,0.05297256730670077,0.05684648255921776,0.05792814243599487,0.0693405127143145,0.06976140031207605,0.07335514586314024,0.07399743693172672,0.07417172989859355,0.09288829951736997,0.09908601576177178,0.1181720189578323,0.1195939387017939,0.1250644439617443,0.1287964316967408,0.1336670715720482,0.1354967908966927,0.1517756904636666,0.1545680323655694,0.1643092864596978,0.1963870872985022,0.2198643470571451,0.2265610453218839,0.5851736632469516,0.6015279230228093,0.7457814716561054,1.098201164622996,1.538197981405061]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>variable<\\/th>\\n      <th>pooled_coef<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Make predictions on the hold-out test set:\n\nMake predictions based on patient information only model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A function to make predictions given a model and a test set\n\nmake_predictions = function(lasso_models, test_data, dependent, independent){\n  \n  d  <- rlang::sym(dependent)\n  f <- as.formula(paste(d, \" ~ .\"))\n  \n  pred = map2(lasso_models, test_data ,\n                  function(lasso, X_in){\n                    \n                    vars = lasso$fit$beta %>% row.names()\n                    \n                    X = X_in %>% \n                      select(dependent, all_of(independent)) %>%\n                      drop_na() %>% \n                      #recipe(!!sym(dependent) ~ .) %>% \n                      recipes::recipe(\n                        formula = f) %>% \n                      step_normalize(all_numeric()) %>% \n                      step_dummy(all_nominal(), -!!sym(dependent)) %>%\n                      step_naomit(everything()) %>% \n                      prep() %>% \n                      juice() %>%\n                      mutate(y = !!sym(dependent) %>%  as.numeric() %>% {. - 1}) %>%\n                      select(., -!!sym(dependent)) #%>%\n                      #select(all_of(vars)) %>% \n                      #as.matrix()\n\n                    #print(paste(\"vars = \", vars))\n                    #print(paste(\"col.names = \", X %>% names()))\n                    #print(paste( \"dim = \", X %>% dim()))\n                    \n                    pred = predict(\n                      lasso$fit,\n                      X %>% select(all_of(vars)) %>% as.matrix(),\n                      s = lasso$opt.lam,\n                      type = \"response\",  #c(\"link\", \"response\", \"coefficients\", \"nonzero\")\n                      )\n                 \n                    out = bind_cols(pred, X %>% \n                                      #as.data.frame() %>% \n                                      select(y)) %>% \n                      dplyr::rename(\"prediction\" = \"s1\", \"truth\" = \"y\") %>% \n                      mutate(truth = factor(truth))\n                  })\n\n  pred\n  }\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Predictions for respiritory complications\npred_basic_rc = make_predictions(lasso_out_basic_rc, \n                              sets_test%>% complete(\"all\"), \n                              \"respiratory_comp\", \n                              independent_basic)\n\npred_basic_lda_rc = make_predictions(lasso_out_basic_lda_rc, \n                              sets_test%>% complete(\"all\"), \n                              \"respiratory_comp\", \n                              independent_basic_lda)\n\npred_basic_lda_med_rc = make_predictions(lasso_out_basic_lda_med_rc, \n                              sets_test%>% complete(\"all\"), \n                              \"respiratory_comp\", \n                              independent_basic_lda_med)\n\npred_basic_lda_med_lab_any_rc = make_predictions(lasso_out_basic_lda_med_lab_any_rc, \n                              sets_test%>% complete(\"all\"), \n                              \"respiratory_comp\", \n                              independent_basic_lda_med_lab_any)\n\npred_basic_lda_med_lab_ext_rc = make_predictions(lasso_out_basic_lda_med_lab_ext_rc, \n                              sets_test%>% complete(\"all\"), \n                              \"respiratory_comp\", \n                              independent_basic_lda_med_lab_ext)\n\n#lasso_out_basic_lda_med_lab_ext = fit_LR(\"death\", independent_basic_lda_med_lab_ext)\n\n\n# Mortality predictions\n\npred_basic_death = make_predictions(lasso_out_basic_death, \n                              sets_test%>% complete(\"all\"), \n                              \"death\", \n                              independent_basic)\n\npred_basic_lda_death = make_predictions(lasso_out_basic_lda_death, \n                              sets_test%>% complete(\"all\"), \n                              \"death\", \n                              independent_basic_lda)\n\npred_basic_lda_med_death = make_predictions(lasso_out_basic_lda_med_death, \n                              sets_test%>% complete(\"all\"), \n                              \"death\", \n                              independent_basic_lda_med)\n\npred_basic_lda_med_lab_any_death = make_predictions(lasso_out_basic_lda_med_lab_any_death, \n                              sets_test%>% complete(\"all\"), \n                              \"death\", \n                              independent_basic_lda_med_lab_any)\n\npred_basic_lda_med_lab_ext_death = make_predictions(lasso_out_basic_lda_med_lab_ext_death, \n                              sets_test%>% complete(\"all\"), \n                              \"death\", \n                              independent_basic_lda_med_lab_ext)\n\n#SPO2\npred_basic_spo2 = make_predictions(lasso_out_basic_spo2, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_intra90\", \n                              independent_basic)\n\npred_basic_lda_spo2 = make_predictions(lasso_out_basic_lda_spo2, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_intra90\", \n                              independent_basic_lda)\n\npred_basic_lda_med_spo2 = make_predictions(lasso_out_basic_lda_med_spo2, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_intra90\", \n                              independent_basic_lda_med)\n\npred_basic_lda_med_lab_any_spo2 = make_predictions(lasso_out_basic_lda_med_lab_any_spo2, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_intra90\", \n                              independent_basic_lda_med_lab_any)\n\npred_basic_lda_med_lab_ext_spo2 = make_predictions(lasso_out_basic_lda_med_lab_ext_spo2, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_intra90\", \n                              independent_basic_lda_med_lab_ext)\n\n\n\n\n#SPO2 post-op\npred_basic_spo2p = make_predictions(lasso_out_basic_spo2p, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_post90\", \n                              independent_basic)\n\npred_basic_lda_spo2p = make_predictions(lasso_out_basic_lda_spo2p, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_post90\", \n                              independent_basic_lda)\n\npred_basic_lda_med_spo2p = make_predictions(lasso_out_basic_lda_med_spo2p, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_post90\", \n                              independent_basic_lda_med)\n\npred_basic_lda_med_lab_any_spo2p = make_predictions(lasso_out_basic_lda_med_lab_any_spo2p, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_post90\", \n                              independent_basic_lda_med_lab_any)\n\npred_basic_lda_med_lab_ext_spo2p = make_predictions(lasso_out_basic_lda_med_lab_ext_spo2p, \n                              sets_test%>% complete(\"all\"), \n                              \"spo2_post90\", \n                              independent_basic_lda_med_lab_ext)\n```\n:::\n\n\nEvaluate model perpormance on the held-out test set:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A function to evaluate model performance\n\neval_performance = function(predictions){\n  \n  \n  \n  # ROC curves\n  roc_curves = map2(predictions, seq(length(predictions)), \n                    function(pred, i){\n                      r = roc_curve(pred, truth, prediction, event_level = \"second\")\n                      r = r %>% \n                        mutate(mice_set = i)\n                      }) %>% \n    bind_rows()\n  \n  # PR curves\n  pr_curves = map2(predictions, seq(length(predictions)), \n                         function(pred, i){\n                           r = pr_curve(pred, truth, prediction, event_level = \"second\")\n                           r = r %>% \n                             mutate(mice_set = i)\n                           }) %>% \n    bind_rows()\n  \n  # AUC\n  auc = map2(predictions, seq(length(predictions)), \n                   function(pred, i){\n                     r = pROC::roc(pred$truth, pred$prediction)\n                     auc_int = pROC::ci.auc(r)\n                     auc_est = pROC::auc(r)\n    \n#    r2 = roc_curve(pred_basic[[1]], truth, prediction, event_level = \"second\")\n                     auc = roc_auc(pred, truth, prediction, event_level = \"second\")\n                     \n                     auc = auc %>% mutate(auc_lower = auc_int[[1]],\n                     auc_upper = auc_int[[3]],\n                     auc_alt = auc_est[[1]],\n                     auc_se = (auc_int[[3]]-auc_int[[1]])/3.92\n                     ) %>% \n                       mutate(mice_set = i)\n                     }) %>% \n    bind_rows()\n  \n  # PRAUC\n  auprc = map2(predictions, seq(length(predictions)), \n                     function(pred, i){\n                       auc = pr_auc(pred, truth, prediction, event_level = \"second\") %>% \n                         mutate(mice_set = i)\n                       }) %>% \n    bind_rows()\n\n  # Pooled AUC\n  # Usin Rubin's rules to pool the AUC estimate and SE\n\n  pooled_estimate = auc$.estimate %>% mean()\n  var_within = auc$auc_se %>% mean()\n  var_between = auc$.estimate %>% var()\n  pooled_se = var_within+var_between*(1+1/nrow(auc))\n  pooled_ci = pooled_se*3.92/2.\n  pooled_auc = data.frame(\"pooled_estimate\" = pooled_estimate,\n                                \"pooled_lower\" = pooled_estimate-pooled_ci,\n                                \"pooled_upper\" = pooled_estimate+pooled_ci,\n                                \"pooled_se\" = pooled_se)\n\n  # Pooled AUPRC\n\n  pooled_prauc = auprc$.estimate %>% mean()\n  \n  \n  # collect results\n  \n  out = list(\n    \"roc_curves\" = roc_curves,\n    \"pr_curves\" = pr_curves,\n    \"auc\" = auc,\n    \"auprc\" = auprc,\n    \"pooled_auc\" = pooled_auc,\n    \"pooled_prauc\" = pooled_prauc\n  )\n  \n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Evaluate performance\n\neval_basic_rc = eval_performance(pred_basic_rc)\neval_basic_lda_rc = eval_performance(pred_basic_lda_rc)\neval_basic_lda_med_rc = eval_performance(pred_basic_lda_med_rc)\neval_basic_lda_med_lab_any_rc = eval_performance(pred_basic_lda_med_lab_any_rc)\neval_basic_lda_med_lab_ext_rc = eval_performance(pred_basic_lda_med_lab_ext_rc)\n\n\n# Mortality \n\neval_basic_death = eval_performance(pred_basic_death)\neval_basic_lda_death = eval_performance(pred_basic_lda_death)\neval_basic_lda_med_death = eval_performance(pred_basic_lda_med_death) \neval_basic_lda_med_lab_any_death = eval_performance(pred_basic_lda_med_lab_any_death)  \neval_basic_lda_med_lab_ext_death = eval_performance(pred_basic_lda_med_lab_ext_death)\n  \n  \n#SPO2\neval_basic_spo2 = eval_performance(pred_basic_spo2)\neval_basic_lda_spo2 = eval_performance(pred_basic_lda_spo2)\neval_basic_lda_med_spo2 = eval_performance(pred_basic_lda_med_spo2)\neval_basic_lda_med_lab_any_spo2 = eval_performance(pred_basic_lda_med_lab_any_spo2)\neval_basic_lda_med_lab_ext_spo2 = eval_performance(pred_basic_lda_med_lab_ext_spo2)\n\n\n\n#SPO2 post-op\neval_basic_spo2p = eval_performance(pred_basic_spo2p)\neval_basic_lda_spo2p = eval_performance(pred_basic_lda_spo2p)\neval_basic_lda_med_spo2p = eval_performance(pred_basic_lda_med_spo2p)\neval_basic_lda_med_lab_any_spo2p = eval_performance(pred_basic_lda_med_lab_any_spo2p)\neval_basic_lda_med_lab_ext_spo2p = eval_performance(pred_basic_lda_med_lab_ext_spo2p)\n```\n:::\n\n\n## ROC curves\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n\n## Pooled AUC\n\n### Respiratory complications\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-587e3c18a77e74ae00e4\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-587e3c18a77e74ae00e4\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.706\\\" data-max=\\\"0.749\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.65\\\" data-max=\\\"0.692\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.760865488211452\\\" data-max=\\\"0.805092026150824\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"info\",\"info+LDA\",\"info+LDA+medicines\",\"info+LDA+medicines+labs(any)\",\"info+LDA+medicines+labs(ext)\"],[0.706,0.716,0.723,0.749,0.73],[0.65,0.656,0.663,0.6919999999999999,0.664],[0.7608654882114522,0.7760891662937379,0.7825149095500987,0.8050920261508239,0.7945837625328426]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>pooled_estimate<\\/th>\\n      <th>pooled_lower<\\/th>\\n      <th>pooled_upper<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### Death\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-5ee24c0ef8cbd54ec9fb\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5ee24c0ef8cbd54ec9fb\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.762\\\" data-max=\\\"0.95\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.728\\\" data-max=\\\"0.937\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.794946470834244\\\" data-max=\\\"0.962384551779342\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"info\",\"info+LDA\",\"info+LDA+medicines\",\"info+LDA+medicines+labs(any)\",\"info+LDA+medicines+labs(ext)\"],[0.762,0.901,0.915,0.95,0.929],[0.728,0.884,0.897,0.9370000000000001,0.911],[0.7949464708342441,0.917416485160496,0.9329711100814718,0.9623845517793415,0.9473367827683689]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>pooled_estimate<\\/th>\\n      <th>pooled_lower<\\/th>\\n      <th>pooled_upper<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### SPO2\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-3b539ace6ea502f30dd2\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3b539ace6ea502f30dd2\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.623\\\" data-max=\\\"0.639\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.61\\\" data-max=\\\"0.627\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.635335683161356\\\" data-max=\\\"0.654643382131813\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"info\",\"info+LDA\",\"info+LDA+medicines\",\"info+LDA+medicines+labs(any)\",\"info+LDA+medicines+labs(ext)\"],[0.623,0.632,0.638,0.639,0.639],[0.61,0.619,0.626,0.627,0.624],[0.6353356831613569,0.6448148099509011,0.6509190908739604,0.6520189804524744,0.6546433821318123]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>pooled_estimate<\\/th>\\n      <th>pooled_lower<\\/th>\\n      <th>pooled_upper<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### SPO2 Post-op\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-dbffca176d2d3ace2dec\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-dbffca176d2d3ace2dec\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.65\\\" data-max=\\\"0.708\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.638\\\" data-max=\\\"0.696\\\" data-scale=\\\"3\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.663321678087911\\\" data-max=\\\"0.721003302191257\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"info\",\"info+LDA\",\"info+LDA+medicines\",\"info+LDA+medicines+labs(any)\",\"info+LDA+medicines+labs(ext)\"],[0.65,0.696,0.699,0.708,0.673],[0.638,0.6840000000000001,0.6870000000000001,0.696,0.658],[0.6633216780879115,0.708925242231732,0.7119929175691714,0.721003302191257,0.6880975189645124]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>pooled_estimate<\\/th>\\n      <th>pooled_lower<\\/th>\\n      <th>pooled_upper<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Precision-recall curves and AUPRC\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](baseline_LR_model_files/figure-html/unnamed-chunk-49-1.png){width=672}\n:::\n:::\n\n\n## Pooled AUPRC\n\n### Respiratory complications\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\n  \"explanatory\" = c(\"basic\", \n                    \"basic+lda\",\n                    \"basic+lda+med\",\n                    \"basic+lda+med+lab(any)\",\n                    \"basic+lda+med+labs(ext)\"),\n  \"AUPRC\" = c(eval_basic_rc$pooled_prauc,\n              eval_basic_lda_rc$pooled_prauc,\n              eval_basic_lda_med_rc$pooled_prauc,\n              eval_basic_lda_med_lab_any_rc$pooled_prauc,\n              eval_basic_lda_med_lab_ext_rc$pooled_prauc)\n) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-e1a290d590d536304151\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e1a290d590d536304151\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.024472515058273\\\" data-max=\\\"0.232304570464026\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"basic\",\"basic+lda\",\"basic+lda+med\",\"basic+lda+med+lab(any)\",\"basic+lda+med+labs(ext)\"],[0.02447251505827324,0.1208212430784952,0.178298680758049,0.1871416083675193,0.2323045704640251]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>AUPRC<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### Death\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\n  \"explanatory\" = c(\"basic\", \n                    \"basic+lda\",\n                    \"basic+lda+med\",\n                    \"basic+lda+med+lab(any)\",\n                    \"basic+lda+med+labs(ext)\"),\n  \"AUPRC\" = c(eval_basic_death$pooled_prauc,\n              eval_basic_lda_death$pooled_prauc,\n              eval_basic_lda_med_death$pooled_prauc,\n              eval_basic_lda_med_lab_any_death$pooled_prauc,\n              eval_basic_lda_med_lab_ext_death$pooled_prauc)\n) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-34dcf722f766c219b02a\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-34dcf722f766c219b02a\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.069967227039316\\\" data-max=\\\"0.37537072163778\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"basic\",\"basic+lda\",\"basic+lda+med\",\"basic+lda+med+lab(any)\",\"basic+lda+med+labs(ext)\"],[0.06996722703931604,0.1568545571666592,0.233554374677467,0.3579396635105231,0.3753707216377791]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>AUPRC<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### SPO2\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\n  \"explanatory\" = c(\"basic\", \n                    \"basic+lda\",\n                    \"basic+lda+med\",\n                    \"basic+lda+med+lab(any)\",\n                    \"basic+lda+med+labs(ext)\"),\n  \"AUPRC\" = c(eval_basic_spo2$pooled_prauc,\n              eval_basic_lda_spo2$pooled_prauc,\n              eval_basic_lda_med_spo2$pooled_prauc,\n              eval_basic_lda_med_lab_any_spo2$pooled_prauc,\n              eval_basic_lda_med_lab_ext_spo2$pooled_prauc)\n) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-e3acf1dd59abdb4fe1b7\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e3acf1dd59abdb4fe1b7\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.310044158276198\\\" data-max=\\\"0.360163378569996\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"basic\",\"basic+lda\",\"basic+lda+med\",\"basic+lda+med+lab(any)\",\"basic+lda+med+labs(ext)\"],[0.3100441582761981,0.3177802695511524,0.3292908008571763,0.333918569489672,0.3601633785699959]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>AUPRC<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### SPO2 (Post-op)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(\n  \"explanatory\" = c(\"basic\", \n                    \"basic+lda\",\n                    \"basic+lda+med\",\n                    \"basic+lda+med+lab(any)\",\n                    \"basic+lda+med+labs(ext)\"),\n  \"AUPRC\" = c(eval_basic_spo2p$pooled_prauc,\n              eval_basic_lda_spo2p$pooled_prauc,\n              eval_basic_lda_med_spo2p$pooled_prauc,\n              eval_basic_lda_med_lab_any_spo2p$pooled_prauc,\n              eval_basic_lda_med_lab_ext_spo2p$pooled_prauc)\n) %>% \n  mydt()\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-a4b3cb42937275804049\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a4b3cb42937275804049\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.263721285658155\\\" data-max=\\\"0.366257439854109\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"basic\",\"basic+lda\",\"basic+lda+med\",\"basic+lda+med+lab(any)\",\"basic+lda+med+labs(ext)\"],[0.2637212856581557,0.3200593625893527,0.326963221239769,0.3356095469977607,0.3662574398541089]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>explanatory<\\/th>\\n      <th>AUPRC<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":1}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n## Risk tables\n\n\n::: {.cell warining='false'}\n\n```{.r .cell-code}\n# A function to scan over threshold values tabulating TN, etc. and Youden's J statistic\ntscan = function(pred, upper_t=0.2, downsample_t = 10){\n  \n  thresholds = pred %>% \n    distinct(prediction) %>%\n    filter(prediction <= upper_t) %>% \n    arrange(prediction)\n  \n#  take every nth value\n\n  thresholds = thresholds %>% \n    magrittr::extract(seq(1, nrow(thresholds), downsample_t), ) %>% \n    pull(prediction)\n\n # print(thresholds %>% class())\n # print(thresholds %>% names())\n # print(thresholds %>% length())\n  \n  # Calculate PPV for each threshold\n  out = \n  thresholds %>% map(function(t){\n    df = pred %>% \n      mutate(prediction_thresh = case_when(\n        prediction < t ~ 0,\n        prediction >= t ~ 1\n      )) %>% \n      mutate(\n        TP = case_when(\n          (truth == 1) & (prediction_thresh == 1) ~ 1,\n          TRUE ~ 0\n        ),\n        FP = case_when(\n          (truth == 0) & (prediction_thresh == 1) ~ 1,\n          TRUE ~ 0\n        ),\n        TN = case_when(\n          (truth == 0) & (prediction_thresh == 0) ~ 1,\n          TRUE ~ 0\n        ),\n        FN = case_when(\n          (truth == 1) & (prediction_thresh == 0) ~ 1,\n          TRUE ~ 0\n        )\n        ,\n        thres = t\n      )\n\n    \n        \n    tp = sum(df$TP)\n    fp = sum(df$FP)\n    tn = sum(df$TN)\n    fn = sum(df$FN)   \n    \n    \n    ppv = tp/(tp+fp)\n    data.frame(\n              \"t\" = t,\n               \"TP\" = tp, \n               \"FP\" = fp, \n               \"TN\" = tn,\n               \"FN\" = fn,\n                \"n\" = (tp+fp+tn+fn),\n               \"ppv\" = ppv,\n               \"fdr\" = fp/(fp+tp),\n              \"fpr\" = fp/(fp+tn),\n              \"tpr\" = tp/(tp+fn),\n              \"J\" = tp/(tp+fn)-fp/(fp+tn),\n              \"acc\" = (tp+tn)/(tp+fp+tn+fn)\n               )\n  \n  }) %>% \n    bind_rows()\n}\n\n\n#tscans_basic = \n#  map2(pred_basic, seq(length(pred_basic)), ~ tscan(.x) %>% mutate(mice = .y))\n\n\ntscans_basic_rc = \n  map2(pred_basic_rc, seq(length(pred_basic_rc)), ~ tscan(.x) %>% mutate(mice = .y))\n\ntscans_basic_death = \n  map2(pred_basic_death, seq(length(pred_basic_death)), ~ tscan(.x) %>% mutate(mice = .y))\n\ntscans_basic_spo2 = \n  map2(pred_basic_rc, seq(length(pred_basic_spo2)), ~ tscan(.x) %>% mutate(mice = .y))\n\ntscans_basic_spo2p = \n  map2(pred_basic_rc, seq(length(pred_basic_spo2p)), ~ tscan(.x) %>% mutate(mice = .y))\n\n#tscans_basic %>% \n#  bind_rows() %>% \n#  mutate(mice = factor(mice)) %>% \n#  ggplot(aes(x=t, y=J, color = mice))+\n#  geom_line()\n```\n:::\n\n\nOptimal threshold for confusion matrix calculated as via optimizing Youden's J statistic:\n\n\n::: {.cell warining='false'}\n\n```{.r .cell-code}\nopt_threshold = function(scan){\n  map(scan, function(ts){\n    ts %>% arrange(desc(J)) %>% magrittr::extract2(1, \"t\")\n    }) %>% \n  as.numeric() %>% \n  mean()\n}\n\n\nopt1_basic_rc = opt_threshold(tscans_basic_rc)\nopt1_basic_death = opt_threshold(tscans_basic_death)\nopt1_basic_spo2 = opt_threshold(tscans_basic_spo2)\nopt1_basic_spo2p = opt_threshold(tscans_basic_spo2p)\n```\n:::\n\n\nA function for composing risk tables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A function to compose a risk table \n\n\n# Prognos function for automatic table generation ---------------------------------------\nprognos <- function(.data, estimate, truth){\n  .estimate = sym(estimate)\n  .truth = sym(truth) \n  .data %>% \n    drop_na(!! .estimate, !! .truth) %>% \n    summarise(\n      N = n(),\n      TP = sum(!! .truth == 1 & !! .estimate == 1),\n      TN = sum(!! .truth == 0  & !! .estimate == 0),\n      FP = sum(!! .truth == 0  & !! .estimate == 1),\n      FN = sum(!! .truth == 1  & !! .estimate == 0),\n      Sens = sens(., !! .truth, !! .estimate)$.estimate,\n      Spec = spec(., !! .truth, !! .estimate)$.estimate,\n      PPV = ppv(., !! .truth, !! .estimate)$.estimate,\n      NPV = npv(., !! .truth, !! .estimate)$.estimate,\n      above = paste0(TP + FP, \" (\", ((100*(TP + FP))/N) %>% round_tidy(1), \")\"),\n      below = paste0(TN + FN, \" (\", ((100*(TN + FN))/N) %>% round_tidy(1), \")\")\n    ) %>% \n    mutate_at(vars(\"Sens\", \"Spec\", \"PPV\", \"NPV\"), ~ prod(., 100)) %>% \n    mutate(across(c(everything(), -above, -below), round, digits = 1))\n}\n\n\n\n# Rule out table ---------------------------------------------------------\n## These tables could be combined\n## Set cut-offs\n\nrtbl = function(predictions, opt_threshold){\n  \n  tbl = predictions %>% \n  map(~ mutate(., subjid = seq(nrow(.)))) %>% \n  bind_rows() %>% \n  group_by(subjid) %>% \n  summarise(\n    estimate = mean(prediction),\n    truth = first(truth)\n  ) %>% \n  \n  mutate(\n    cutoff2 = case_when(\n      estimate <= 0.005 ~ 0,\n      estimate > 0.005 ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor(),\n    cutoff3 = case_when(\n      estimate <= 0.01 ~ 0,\n      estimate > 0.01 ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor(),\n    cutoff4 = case_when(\n      estimate <= 0.02 ~ 0,\n      estimate > 0.02 ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor(),\n    cutoff5 = case_when(\n      estimate <= 0.03 ~ 0,\n      estimate > 0.03 ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor(),\n    cutoff6 = case_when(\n      estimate <= 0.04 ~ 0,\n      estimate > 0.04 ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor(),\n    cutoff7 = case_when(\n      estimate <= opt_threshold ~ 0,\n      estimate > opt_threshold ~ 1,\n      TRUE ~ NA_real_) %>%\n      factor()#,\n#    cutoff8 = case_when(\n#      estimate <= 0.1 ~ 0,\n#      estimate > 0.1 ~ 1,\n#      TRUE ~ NA_real_) %>%\n#      factor()#,\n#    cutoff9 = case_when(\n#      estimate <= 0.2 ~ 0,\n#      estimate > 0.2 ~ 1,\n#      TRUE ~ NA_real_) %>%\n#      factor(),     \n#    cutoff10 = case_when(\n#      estimate <= 0.5 ~ 0,\n#      estimate > 0.5 ~ 1,\n#      TRUE ~ NA_real_) %>%\n#      factor()\n  ) %>% \n  select(truth, dplyr::starts_with(\"cutoff\")) %>% \n  mutate(truth  = factor(truth))\n\nmap_df(list(\n  \"<=0.005\" = \"cutoff2\",\n  \"<=0.01\" = \"cutoff3\",\n  \"<=0.02\" = \"cutoff4\",\n  \"<=0.03\" = \"cutoff5\",\n  \"<=0.04\" = \"cutoff6\",\n  \"<= opt\" = \"cutoff7\"#,\n#  \"<=8\" = \"cutoff8\",\n#  \"<=9\" = \"cutoff9\",\n#  \"<=10\" = \"cutoff10\"\n),\n~ prognos(tbl, .x, \"truth\"), .id= \"threshold\") #%>%\n#  mytable(caption = \"Sensitivity, specificity, postitive predicive value and negative predictive value for Isaric score cut-offs for mortality\")\n}\n```\n:::\n\n\nScan over thresholds to maximize Youden's J statistic:\n\n\n::: {.cell warining='false'}\n\n```{.r .cell-code}\n# Rule out table ---------------------------------------------------------\n## These tables could be combined\n## Set cut-offs\n\ntbl_ruleout_basic_rc = rtbl(pred_basic_rc, opt1_basic_rc)\ntbl_ruleout_basic_death = rtbl(pred_basic_death, opt1_basic_death)\ntbl_ruleout_basic_spo2 = rtbl(pred_basic_spo2, opt1_basic_spo2)\n#tbl_ruleout_basic_spo2p = rtbl(pred_basic_spo2p, opt1_basic_spo2p)\n```\n:::\n\n\n### Risk tables\n\nAll risk tables shown are based on basic patient information models. Note that a range of threshold values are shown as well as a optimal threshold calculated as via optimizing Youden's J statistic:\n\n### Respiratory complications\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-56b277341d419f88aade\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-56b277341d419f88aade\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\" disabled=\\\"\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"5\\\" data-max=\\\"85\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"4006\\\" data-max=\\\"11079\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"66\\\" data-max=\\\"7139\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"11\\\" data-max=\\\"91\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"35.9\\\" data-max=\\\"99.4\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"5.2\\\" data-max=\\\"88.5\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"99.2\\\" data-max=\\\"99.7\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1.2\\\" data-max=\\\"7\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"&lt;=0.005\",\"&lt;=0.01\",\"&lt;=0.02\",\"&lt;=0.03\",\"&lt;=0.04\",\"&lt;= opt\"],[11241,11241,11241,11241,11241,11241],[85,59,22,8,5,69],[4006,7945,10522,10972,11079,7068],[7139,3200,623,173,66,4077],[11,37,74,88,91,27],[35.9,71.3,94.40000000000001,98.40000000000001,99.40000000000001,63.4],[88.5,61.5,22.9,8.300000000000001,5.2,71.90000000000001],[99.7,99.5,99.3,99.2,99.2,99.59999999999999],[1.2,1.8,3.4,4.4,7,1.7],[\"7224 (64.3)\",\"3259 (29.0)\",\"645 (5.7)\",\"181 (1.6)\",\"71 (0.6)\",\"4146 (36.9)\"],[\"4017 (35.7)\",\"7982 (71.0)\",\"10596 (94.3)\",\"11060 (98.4)\",\"11170 (99.4)\",\"7095 (63.1)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>threshold<\\/th>\\n      <th>N<\\/th>\\n      <th>TP<\\/th>\\n      <th>TN<\\/th>\\n      <th>FP<\\/th>\\n      <th>FN<\\/th>\\n      <th>Sens<\\/th>\\n      <th>Spec<\\/th>\\n      <th>PPV<\\/th>\\n      <th>NPV<\\/th>\\n      <th>above<\\/th>\\n      <th>below<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#### Death\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-643008aa648afa6bc6cd\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-643008aa648afa6bc6cd\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\" disabled=\\\"\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"88\\\" data-max=\\\"144\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"6197\\\" data-max=\\\"10095\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"953\\\" data-max=\\\"4851\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"49\\\" data-max=\\\"105\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"56.1\\\" data-max=\\\"91.4\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"45.6\\\" data-max=\\\"74.6\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"99\\\" data-max=\\\"99.2\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"2.9\\\" data-max=\\\"8.5\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"&lt;=0.005\",\"&lt;=0.01\",\"&lt;=0.02\",\"&lt;=0.03\",\"&lt;=0.04\",\"&lt;= opt\"],[11241,11241,11241,11241,11241,11241],[144,121,105,95,88,118],[6197,9141,9835,9960,10095,9501],[4851,1907,1213,1088,953,1547],[49,72,88,98,105,75],[56.1,82.7,89,90.2,91.40000000000001,86],[74.59999999999999,62.7,54.4,49.2,45.6,61.1],[99.2,99.2,99.09999999999999,99,99,99.2],[2.9,6,8,8,8.5,7.1],[\"4995 (44.4)\",\"2028 (18.0)\",\"1318 (11.7)\",\"1183 (10.5)\",\"1041 (9.3)\",\"1665 (14.8)\"],[\"6246 (55.6)\",\"9213 (82.0)\",\"9923 (88.3)\",\"10058 (89.5)\",\"10200 (90.7)\",\"9576 (85.2)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>threshold<\\/th>\\n      <th>N<\\/th>\\n      <th>TP<\\/th>\\n      <th>TN<\\/th>\\n      <th>FP<\\/th>\\n      <th>FN<\\/th>\\n      <th>Sens<\\/th>\\n      <th>Spec<\\/th>\\n      <th>PPV<\\/th>\\n      <th>NPV<\\/th>\\n      <th>above<\\/th>\\n      <th>below<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#### SPO2\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-4fe7823cf3bbb98ac818\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-4fe7823cf3bbb98ac818\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\" disabled=\\\"\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"2340\\\" data-max=\\\"2438\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"3\\\" data-max=\\\"568\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"8235\\\" data-max=\\\"8800\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"98\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0\\\" data-max=\\\"6.5\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"96\\\" data-max=\\\"100\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"85\\\" data-max=\\\"100\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"21.7\\\" data-max=\\\"22.1\\\" data-scale=\\\"1\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"extensions\":[\"Buttons\"],\"data\":[[\"&lt;=0.005\",\"&lt;=0.01\",\"&lt;=0.02\",\"&lt;=0.03\",\"&lt;=0.04\",\"&lt;= opt\"],[11241,11241,11241,11241,11241,11241],[2438,2417,2366,2346,2340,2426],[3,135,407,540,568,85],[8800,8668,8396,8263,8235,8718],[0,21,72,92,98,12],[0,1.5,4.6,6.1,6.5,1],[100,99.09999999999999,97,96.2,96,99.5],[100,86.5,85,85.40000000000001,85.3,87.59999999999999],[21.7,21.8,22,22.1,22.1,21.8],[\"11238 (100.0)\",\"11085 (98.6)\",\"10762 (95.7)\",\"10609 (94.4)\",\"10575 (94.1)\",\"11144 (99.1)\"],[\"3 (0.0)\",\"156 (1.4)\",\"479 (4.3)\",\"632 (5.6)\",\"666 (5.9)\",\"97 (0.9)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>threshold<\\/th>\\n      <th>N<\\/th>\\n      <th>TP<\\/th>\\n      <th>TN<\\/th>\\n      <th>FP<\\/th>\\n      <th>FN<\\/th>\\n      <th>Sens<\\/th>\\n      <th>Spec<\\/th>\\n      <th>PPV<\\/th>\\n      <th>NPV<\\/th>\\n      <th>above<\\/th>\\n      <th>below<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":20,\"autoWidth\":true,\"scrollX\":true,\"searchHighlight\":true,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[1,2,3,4,5,6,7,8,9]}],\"order\":[],\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n",
    "supporting": [
      "baseline_LR_model_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.29/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/dt-ext-buttons-1.13.4/css/buttons.dataTables.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-ext-buttons-1.13.4/js/dataTables.buttons.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.4/js/buttons.html5.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.4/js/buttons.colVis.min.js\"></script>\n<script src=\"site_libs/dt-ext-buttons-1.13.4/js/buttons.print.min.js\"></script>\n<link href=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"site_libs/dt-plugin-searchhighlight-1.13.4/source.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-plugin-searchhighlight-1.13.4/jquery.highlight.js\"></script>\n<script src=\"site_libs/dt-plugin-searchhighlight-1.13.4/source.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}